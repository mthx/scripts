#!/usr/bin/env bash
set -euo pipefail

COMMIT_MSG_FILE="/tmp/ccommit-msg-$$.txt"
trap 'rm -f "$COMMIT_MSG_FILE"' EXIT

cat <<EOF | claude -p --dangerously-skip-permissions --allowedTools "Read,Glob,Grep,Bash(git *),Write(/tmp/ccommit-msg-*.txt)"
Analyze the current git changes and draft a commit message.

- Review staged and unstaged changes
- Check recent commits for style (git log)
- Stage relevant files (avoiding .env/secrets)
- Write a concise commit message to $COMMIT_MSG_FILE

DO NOT run git commit yourself - just stage files and write the message.
EOF

git commit -e -F "$COMMIT_MSG_FILE"
